---
// src/components/ImageMagic.astro
interface Props {
  src: string;
  alt: string;
  className?: string;
  aspect?: "video" | "square" | "portrait" | "wide";
}

const { src, alt, className = "", aspect = "video" } = Astro.props;

const aspectRatios = {
  video: "aspect-video",
  square: "aspect-square",
  portrait: "aspect-[3/4]",
  wide: "aspect-[21/9]",
};

const aspectClass = aspectRatios[aspect];
---

<div class={`relative overflow-hidden bg-[#0a1412] group ${aspectClass} ${className} reveal-frame`}>
  <div class="absolute inset-0 bg-[#1a2a3a] mix-blend-multiply z-10 opacity-60"></div>

  <div class="absolute inset-0 z-20 opacity-[0.03] pointer-events-none mix-blend-overlay grain-overlay"></div>

  <img
    src={src}
    alt={alt}
    loading="lazy"
    decoding="async"
    class="w-full h-full object-cover object-center 
           filter grayscale contrast-[1.2] brightness-[0.9]
           transition-all duration-[1500ms] ease-[cubic-bezier(0.23,1,0.32,1)]
           group-hover:scale-[1.03] group-hover:brightness-100 group-hover:contrast-[1.1]
           img-magic-reveal"
  />

  <div class="absolute inset-0 z-30 opacity-40 mix-blend-soft-light pointer-events-none
              bg-[radial-gradient(circle_at_center,_transparent_30%,_#0d1a16_100%)]">
  </div>
</div>

<style>
  /* Efecto de Marco de Arquitecto */
  .reveal-frame {
    mask-image: linear-gradient(to right, black, black);
    mask-repeat: no-repeat;
    mask-size: 0% 100%;
    animation: reveal-mask 1.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
  }

  /* Animaci칩n de Grano Cinematogr치fico */
  .grain-overlay {
    background-image: url("https://www.transparenttextures.com/patterns/stardust.png");
    animation: grain-shift 8s steps(10) infinite;
  }

  /* Revelado tipo Cianotipo (Entrada suave) */
  .img-magic-reveal {
    opacity: 0;
    filter: grayscale(1) contrast(1.5) blur(5px);
    animation: chemical-reveal 2s cubic-bezier(0.23, 1, 0.32, 1) forwards;
    animation-delay: 0.3s;
  }

  @keyframes reveal-mask {
    to { mask-size: 100% 100%; }
  }

  @keyframes chemical-reveal {
    to { 
      opacity: 0.9; 
      filter: grayscale(0.8) contrast(1.2) blur(0);
    }
  }

  @keyframes grain-shift {
    0%, 100% { transform: translate(0, 0); }
    10% { transform: translate(-1%, -1%); }
    20% { transform: translate(1%, 1%); }
    /* ... a침ade variaciones para un look org치nico */
  }
</style>